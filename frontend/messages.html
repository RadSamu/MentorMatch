<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Messaggi - MentorMatch</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Aggiungiamo una favicon in formato SVG per risolvere l'errore 404 -->
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%230d6efd' d='M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z'/%3E%3C/svg%3E">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/css/style.css">
    <style>
        /* Stili specifici inline minimi, il resto Ã¨ in style.css */
        .date-separator { position: relative; text-align: center; margin: 1.5rem 0; }
        .date-separator::before { content: ''; position: absolute; top: 50%; left: 0; right: 0; border-top: 1px solid #dee2e6; z-index: 0; }
        .date-separator span { background-color: #fff; padding: 0 10px; color: #6c757d; font-size: 0.75rem; position: relative; z-index: 1; }
        .message.pending { opacity: 0.6; }
        .message.error .message-bubble { background-color: #dc3545; }
        .message-status { font-size: 0.75rem; color: #adb5bd; }
        .retry-btn { color: #dc3545; font-size: 0.75rem; cursor: pointer; text-decoration: underline; }
    </style>
</head>
<body>
    <div id="navbar-placeholder"></div>

    <!-- Header Sfumato -->
    <div class="profile-header text-center">
        <div class="container">
            <h2 class="fw-bold mb-2">Messaggi</h2>
            <p class="opacity-75">Chatta con i tuoi mentor e mentee in tempo reale.</p>
        </div>
    </div>

    <div class="container pb-5">
        <div class="card chat-container">
            <div class="row g-0 h-100">
                <!-- Colonna Conversazioni -->
                <div class="col-md-4 conversations-list">
                    <div class="list-group list-group-flush" id="conversations-list">
                        <!-- Elenco conversazioni -->
                    </div>
                </div>
                <!-- Colonna Destra: Contenitore per la chat o la finestra di benvenuto -->
                <div class="col-md-8 h-100 chat-main-area">
                    <!-- Finestra di benvenuto (visibile all'inizio) -->
                    <div class="d-flex flex-column h-100 justify-content-center align-items-center text-center" id="welcome-window">
                        <div class="bg-light rounded-circle p-4 mb-3">
                            <i class="fas fa-paper-plane fa-3x text-primary"></i>
                        </div>
                        <h4 class="fw-bold">I tuoi Messaggi</h4>
                        <p class="text-muted">Seleziona una conversazione dalla lista a sinistra per iniziare a chattare.</p>
                    </div>
                    <!-- Contenitore della Chat (nascosto all'inizio) -->
                    <div class="d-none flex-column flex-grow-1 h-100" id="chat-container">
                        <!-- Header della Chat -->
                        <div class="chat-header" id="chat-header"></div>
                        <!-- Box dei Messaggi -->
                        <div class="messages-box" id="messages-list"></div>
                        <!-- Form di Invio Messaggio -->
                        <form id="message-form" class="message-form">
                            <input type="hidden" id="receiver-id-input">
                            <div class="message-input-wrapper">
                                <textarea id="message-input" class="form-control shadow-none" placeholder="Scrivi un messaggio..." rows="1" required></textarea>
                                <button type="submit" class="btn btn-primary send-btn rounded-circle shadow-sm"><i class="fas fa-paper-plane"></i></button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div id="footer-placeholder"></div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/global.js"></script>
    <script src="/js/messages.js"></script>
</body>
</html>